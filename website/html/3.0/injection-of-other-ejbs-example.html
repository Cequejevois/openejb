
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <!-- $PAGETITLE -->
    <TITLE>OpenEJB - Injection of other EJBs Example</TITLE>
    <LINK href="http://openejb.apache.org/all.css" rel="stylesheet" type="text/css">
    <!--[if IE]><link rel="stylesheet" type="text/css" media="screen, projection" href="openejb.apache.org/ie.css"><![endif]-->

    <LINK rel="SHORTCUT ICON" href="http://openejb.apache.org/images/favicon.ico">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>

    <!-- Delay the loading of the external javascript file needed for labels (as it takes too long to load and visibly holds loading of the page body) -->
    <!-- To do this without javascript errors over undefined functions, we need to declare stubs here (that are overrided later by the proper implementations) -->
    <SCRIPT language="JavaScript" type="text/javascript">
      function doAddLabel(hideTextfieldAfterAddParam)
      {
      // stub
      }

      function onAddLabel()
      {
      // stub
      }

      function showLabelsInput()
      {
      // stub
      }
    </SCRIPT>

    <A name="top"></A>
    <TABLE class="frameTable" cellpadding="0" cellspacing="0" border="0">
      <TR class="Row1">
        <TD class="Col1"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col2"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col3"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
      </TR>
      <TR class="Row2">
        <TD class="Col1"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3" id="breadcrumbs">
          <!-- $TOP_NAV_BAR -->
                    <A href="../OPENEJB/index.html" title="Index">Home</A> | <A href="../OPENEJB/download.html" title="Download">Download</A> | <A href="../OPENEJB/mailing-lists.html" title="Mailing Lists">Lists</A> | <A href="http://issues.apache.org/jira/browse/OPENEJB" class="external-link" rel="nofollow">Issues</A>

        </TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">&nbsp;</TD>
      </TR>
      <TR class="Row3">
        <TD class="Col1"><IMG alt="" class="Row3Img" id="thinLine" src="http://openejb.apache.org/images/line_sm.gif"></TD>
        <TD class="Col2"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col3"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
      </TR>
      <TR class="Row4">
        <TD class="Col1">
          <SPAN id="Navigation">

                        <H3><A name="Navigation-Overview"></A>Overview</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/index.html" title="Index">Home</A></LI>
	<LI><A href="../OPENEJB/news.html" title="News">News</A></LI>
	<LI><A href="../OPENEJB/faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="../OPENEJB/download.html" title="Download">Download</A></LI>
	<LI><A href="index.html" title="Index">Documentation</A></LI>
	<LI><A href="../OPENEJB/examples.html" title="Examples">Examples</A></LI>
	<LI><A href="http://cwiki.apache.org/confluence/display/OPENEJB/Lightening%20Demos" class="external-link" rel="nofollow">Lightning Demos</A></LI>
	<LI><A href="../OPENEJB/mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
	<LI><A href="../OPENEJB/source-code.html" title="Source Code">Source Code</A></LI>
	<LI><A href="http://blogs.apache.org/openejb" class="external-link" rel="nofollow">Project Blog</A></LI>
</UL>


<H3><A name="Navigation-Servers"></A>Servers</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/local-server.html" title="Local Server">Local</A></LI>
	<LI><A href="../OPENEJB/remote-server.html" title="Remote Server">Remote</A></LI>
</UL>


<H3><A name="Navigation-Integrations"></A>Integrations</H3>

<UL class="alternate" type="square">
	<LI><A href="tomcat.html" title="Tomcat">Tomcat</A></LI>
	<LI><A href="../OPENEJB/geronimo.html" title="Geronimo">Geronimo</A></LI>
	<LI><A href="../OPENEJB/webobjects.html" title="WebObjects">WebObjects</A></LI>
</UL>


<H3><A name="Navigation-Community"></A>Community</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/team.html" title="Team">Team</A></LI>
	<LI><A href="../OPENEJB/articles.html" title="Articles">Articles</A></LI>
	<LI><A href="http://webchat.freenode.net/?channels=openejb" class="external-link" rel="nofollow">IRC</A></LI>
</UL>


<H3><A name="Navigation-RelatedProjects"></A>Related Projects</H3>

<UL class="alternate" type="square">
	<LI><A href="http://activemq.apache.org/" class="external-link" rel="nofollow">ActiveMQ</A></LI>
	<LI><A href="http://openjpa.apache.org/" class="external-link" rel="nofollow">OpenJPA</A></LI>
	<LI><A href="http://cxf.apache.org/" class="external-link" rel="nofollow">CXF</A></LI>
</UL>


<H3><A name="Navigation-Index"></A>Index</H3>
<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/space-index.html" title="Space Index">Site Index</A></LI>
	<LI><A href="space-index.html" title="Space Index">Doc Index</A></LI>
</UL>

            <H3>
              <A name="Navigation-Feeds"></A>
              Feeds
            </H3>

            <UL class="feeds">
            <LI>
              <A href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false">
              <IMG src="http://openejb.apache.org/images/rss.gif"></A>
              <A class="feedsText" href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false">Site</A>
            </LI>

            <LI><A href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB">
              <IMG src="http://openejb.apache.org/images/rss.gif"></A>
              <A class="feedsText" href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB">News</A>
            </LI>
            </UL>
          </SPAN>
        </TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3">
          <TABLE id="PageHeader" border="0" width="100%">
            <TR>
              <TD>
                <A href="http://openejb.org/">
                  <IMG hspace="0" src="http://openejb.apache.org/images/logo_openejb.gif" vspace="0">
                </A>
              </TD>
              <TD align="right">
                <A href="http://www.apache.org/">
                  <IMG src="http://www.apache.org/images/asf-logo.gif" width="258" height="66">
                </A>
              </TD>
            </TR>
            <TR>
              <TD id="page_title">
                <!-- $TITLE -->
                Injection of other EJBs Example
              </TD>

              <TD align="right">
                <BR><BR>
                <!-- Google CSE Search Box Begins  -->
                <FORM id="searchbox_010475492895890475512:_t4iqjrgx90" action="http://www.google.com/cse">
                  <INPUT type="hidden" name="cx" value="010475492895890475512:_t4iqjrgx90">
                  <INPUT type="hidden" name="cof" value="FORID:0">
                  <INPUT name="q" type="text" size="25">
                  <INPUT type="submit" name="sa" value="Search">
                </FORM>
                <SCRIPT type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_010475492895890475512:_t4iqjrgx90"></SCRIPT>
                <!-- Google CSE Search Box Ends -->

              </TD>
            </TR>
          </TABLE>
          <P>
            <!-- $BODY -->
            <DIV id="PageContent">
              <H1><A name="InjectionofotherEJBsExample-Overview"></A>Overview</H1>

<P>This example shows how to use the <B>@EJB</B> annotation in a bean class to refer to other beans.</P>

<P>This functionality is often referred as dependency injection, and has been introduced in Java EE 5.</P>

<P>In this particular example, we will create two session stateless beans:</P>

<UL class="alternate" type="square">
	<LI>DataStore session bean</LI>
	<LI>DataReader session bean</LI>
</UL>


<P>The DataReader bean uses the DataStore to retrieve some informations, and we will see how we can, inside the DataReader bean, get a reference to the DataStore bean using the @EJB annotation, thus avoiding the use of the JNDI API.</P>

<P><EM>The source for this example is the &quot;injection-of-ejbs&quot; directory located in the <A href="../OPENEJB/download.html" title="Download">openejb-examples.zip</A> available on the download page.</EM></P>

<H1><A name="InjectionofotherEJBsExample-TheCode"></A>The Code</H1>

<P>In this example we develop two simple session stateless beans (DataReader and DataStore), and show how we can use the @EJB annotation in one of these beans to get the reference to the other session bean</P>

<H2><A name="InjectionofotherEJBsExample-DataStoresessionbean"></A>DataStore session bean</H2>

<H3><A name="InjectionofotherEJBsExample-Bean"></A>Bean</H3>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">@Stateless
<SPAN class="code-keyword">public</SPAN> class DataStoreImpl <SPAN class="code-keyword">implements</SPAN> DataStoreLocal, DataStoreRemote{

	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> getData() {
		<SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;42&quot;</SPAN>;
	}

}
</PRE>
</DIV></DIV>

<H3><A name="InjectionofotherEJBsExample-Localbusinessinterface"></A>Local business interface</H3>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">@Local
<SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">interface</SPAN> DataStoreLocal {
	
	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> getData();
	
}
</PRE>
</DIV></DIV>

<H3><A name="InjectionofotherEJBsExample-Remotebusinessinterface"></A>Remote business interface</H3>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">@Remote
<SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">interface</SPAN> DataStoreRemote {
	
	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> getData();
	
}
</PRE>
</DIV></DIV>

<H2><A name="InjectionofotherEJBsExample-DataReadersessionbean"></A>DataReader session bean</H2>

<H3><A name="InjectionofotherEJBsExample-Bean"></A>Bean</H3>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">@Stateless
<SPAN class="code-keyword">public</SPAN> class DataReaderImpl <SPAN class="code-keyword">implements</SPAN> DataReaderLocal, DataReaderRemote {
	
	@EJB <SPAN class="code-keyword">private</SPAN> DataStoreRemote dataStoreRemote;
	@EJB <SPAN class="code-keyword">private</SPAN> DataStoreLocal dataStoreLocal;
	
	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> readDataFromLocalStore() {
		<SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;LOCAL:&quot;</SPAN>+dataStoreLocal.getData();
	}
	
	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> readDataFromRemoteStore() {
		<SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;REMOTE:&quot;</SPAN>+dataStoreRemote.getData();
	}
}
</PRE>
</DIV></DIV>

<P>Note the usage of the <B>@EJB</B> annotation on the DataStoreRemote and DataStoreLocal fields.  This is the minimum required for EJB ref resolution.  If you have two beans that implement the same business interfaces, you'll want to the <B>beanName</B> attribute as follows:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
@EJB(beanName = <SPAN class="code-quote">&quot;DataStoreImpl&quot;</SPAN>) 
<SPAN class="code-keyword">private</SPAN> DataStoreRemote dataStoreRemote;

@EJB(beanName = <SPAN class="code-quote">&quot;DataStoreImpl&quot;</SPAN>) 
<SPAN class="code-keyword">private</SPAN> DataStoreLocal dataStoreLocal;
</PRE>
</DIV></DIV>

<H3><A name="InjectionofotherEJBsExample-Localbusinessinterface"></A>Local business interface</H3>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">@Local
<SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">interface</SPAN> DataReaderLocal {
	
	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> readDataFromLocalStore();
	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> readDataFromRemoteStore();
}
</PRE>
</DIV></DIV>

<P>(The remote business interface is not shown for the sake of brevity).</P>

<DIV class="panelMacro"><TABLE class="tipMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="https://cwiki.apache.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>@EJB annotation</B><BR>Several components in Java EE can use the @EJB annotation, such as:
<UL>
	<LI>Servlets</LI>
	<LI>ServletContextListeners</LI>
	<LI>Servlet Filters</LI>
	<LI>JSF managed beans</LI>
	<LI>EJB interceptors</LI>
	<LI>JAX-WS service endpoints</LI>
</UL>
</TD></TR></TABLE></DIV>

<H1><A name="InjectionofotherEJBsExample-Writingaunittestfortheexample"></A>Writing a unit test for the example</H1>

<P>Writing an unit test for this example is quite simple. We need just to write a setup method to create and initialize the InitialContext, and then write our test methods</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java"><SPAN class="code-keyword">public</SPAN> class EjbDependencyTest <SPAN class="code-keyword">extends</SPAN> TestCase {

    <SPAN class="code-keyword">private</SPAN> InitialContext initialContext;

    <SPAN class="code-keyword">protected</SPAN> void setUp() <SPAN class="code-keyword">throws</SPAN> Exception {
        Properties properties = <SPAN class="code-keyword">new</SPAN> Properties();
        properties.setProperty(Context.INITIAL_CONTEXT_FACTORY, <SPAN class="code-quote">&quot;org.apache.openejb.client.LocalInitialContextFactory&quot;</SPAN>);

        initialContext = <SPAN class="code-keyword">new</SPAN> InitialContext(properties);
    }

    <SPAN class="code-keyword">public</SPAN> void test() <SPAN class="code-keyword">throws</SPAN> Exception {
        DataReaderLocal dataReader = (DataReaderLocal) initialContext.lookup(<SPAN class="code-quote">&quot;DataReaderImplLocal&quot;</SPAN>);

        assertNotNull(dataReader);

        assertEquals(<SPAN class="code-quote">&quot;LOCAL:42&quot;</SPAN>, dataReader.readDataFromLocalStore());
    	assertEquals(<SPAN class="code-quote">&quot;REMOTE:42&quot;</SPAN>, dataReader.readDataFromRemoteStore());
    }
}
</PRE>
</DIV></DIV>

<H1><A name="InjectionofotherEJBsExample-Running"></A>Running</H1>

<P>Running the example is fairly simple.  In the &quot;injection-of-ejbs&quot; directory of the <A href="../OPENEJB/download.html" title="Download">examples zip</A>, just run:</P>

<BLOCKQUOTE>
<P>$ mvn clean install</P></BLOCKQUOTE>

<P>Which should create output like the following.</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.superbiz.injection.EjbDependencyTest
Apache OpenEJB 3.0    build: 20080408-04:13
http://openejb.apache.org/
INFO - openejb.home = /Users/dblevins/work/openejb-3.0/examples/injection-of-ejbs
INFO - openejb.base = /Users/dblevins/work/openejb-3.0/examples/injection-of-ejbs
INFO - Configuring Service(id=Default Security Service, type=SecurityService, provider-id=Default Security Service)
INFO - Configuring Service(id=Default Transaction Manager, type=TransactionManager, provider-id=Default Transaction Manager)
INFO - Configuring Service(id=Default JDK 1.3 ProxyFactory, type=ProxyFactory, provider-id=Default JDK 1.3 ProxyFactory)
INFO - Found EjbModule in classpath: /Users/dblevins/work/openejb-3.0/examples/injection-of-ejbs/target/classes
INFO - Configuring app: /Users/dblevins/work/openejb-3.0/examples/injection-of-ejbs/target/classes
INFO - Configuring Service(id=Default Stateless Container, type=Container, provider-id=Default Stateless Container)
INFO - Auto-creating a container for bean DataReaderImpl: Container(type=STATELESS, id=Default Stateless Container)
INFO - Loaded Module: /Users/dblevins/work/openejb-3.0/examples/injection-of-ejbs/target/classes
INFO - Assembling app: /Users/dblevins/work/openejb-3.0/examples/injection-of-ejbs/target/classes
INFO - Jndi(name=DataReaderImplLocal) --&gt; Ejb(deployment-id=DataReaderImpl)
INFO - Jndi(name=DataReaderImplRemote) --&gt; Ejb(deployment-id=DataReaderImpl)
INFO - Jndi(name=DataStoreImplLocal) --&gt; Ejb(deployment-id=DataStoreImpl)
INFO - Jndi(name=DataStoreImplRemote) --&gt; Ejb(deployment-id=DataStoreImpl)
INFO - Created Ejb(deployment-id=DataReaderImpl, ejb-name=DataReaderImpl, container=Default Stateless Container)
INFO - Created Ejb(deployment-id=DataStoreImpl, ejb-name=DataStoreImpl, container=Default Stateless Container)
INFO - Deployed Application(path=/Users/dblevins/work/openejb-3.0/examples/injection-of-ejbs/target/classes)
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.705 sec

Results :

Tests run: 2, Failures: 0, Errors: 0, Skipped: 0
</PRE>
</DIV></DIV>


            </DIV>
          </P>
        </TD>
        <TD class="Col4"><IMG src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">
          
            
            </TD>
      </TR>
      <TR class="Row5">
        <TD class="Col1">&nbsp;</TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3">
          <BR>
          <BR>
          <IMG width="100%" height="1" src="http://openejb.apache.org/images/line_light.gif">
          <TABLE width="100%">
            <TR>
              <TD>
                <SPAN class="bodyGrey">
                  <SMALL>
                    <NOTICE><!-- $FOOTER -->
                      Apache OpenEJB is an project of The Apache Software Foundation (ASF)
                    </NOTICE>
                    <BR>
                    Site Powered by
                    <A href="http://atlassian.com/">Atlassian</A>
                    <A href="http://atlassian.com/confluence/">Confluence</A>
                    .
                  </SMALL>
                </SPAN>
              </TD>
              <TD align="right">
                <A style="color:#999;font-size:small;font-weight:normal;" href="https://cwiki.apache.org/confluence/pages/editpage.action?spaceKey=OPENEJBx30&title=Injection%20of%20other%20EJBs%20Example">[ edit ]</A>
              </TD>
            </TR>
          </TABLE>
          <BR>
        </TD>
        <TD class="Col4"><IMG src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">&nbsp;</TD>
      </TR>
    </TABLE>

    <!-- Needed for composition plugin -->
    <!-- delay the loading of large javascript files to the end so that they don't interfere with the loading of page content -->
    <SPAN style="display: none">
      <SCRIPT type="text/javascript" language="JavaScript" src="http://cwiki.apache.org/confluence/labels-javascript"></SCRIPT>

      <SCRIPT src="http://www.google-analytics.com/urchin.js" type="text/javascript">
      </SCRIPT>
      <SCRIPT type="text/javascript">
        _uacct = "UA-2717626-1";
        urchinTracker();
      </SCRIPT>
    </SPAN>

  </BODY>
</HTML>