
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
 <HEAD>
  <!-- $PAGETITLE -->
  <TITLE>OpenEJB - Executables</TITLE>
  <LINK href="http://people.apache.org/~dblevins/openejb/default.css" rel="stylesheet" type="text/css">
  <LINK href="http://people.apache.org/~dblevins/openejb/style.css" rel="stylesheet" type="text/css">
  <LINK rel="SHORTCUT ICON" href="http://incubator.apache.org/openejb/images/favicon.ico">
  <SCRIPT language="JavaScript" src="http://cwiki.apache.org/confluence/pages/viewpage.action?spaceKey=OPENEJB&title=functions.js" type="text/javascript"></SCRIPT>
 <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY bgcolor="#ffffff" link="#6763a9" vlink="#6763a9" topmargin="0" bottommargin="0" leftmargin="0" marginheight="0" marginwidth="0">
  <A name="top"></A>
  <TABLE border="0" cellpadding="0" cellspacing="0" width="100%" height="400">
   <TR>
    <TD width="20" valign="top" align="left" bgcolor="#7270c2"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="1" height="1" border="0"></TD>
    <TD width="95" valign="top" align="left" bgcolor="#7270c2"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="1" height="1" border="0"></TD>
    <TD width="7" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" border="0" width="1" height="1"></TD>
    <TD width="40" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="40" height="6" border="0"></TD>
    <TD width="100%" valign="top" align="left" bgcolor="#5A5CB8"><IMG src="http://incubator.apache.org/openejb/images/top_2.gif" width="430" height="6" border="0"></TD>
    <TD width="120" valign="top" align="left" bgcolor="#E24717"><IMG src="http://incubator.apache.org/openejb/images/top_3.gif" width="120" height="6" border="0"></TD>
   </TR>
   <TR>
    <TD width="20" bgcolor="#7270c2" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" border="0" width="1" height="1"></TD>
    <TD width="95" bgcolor="#7270c2" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" border="0" width="1" height="1"></TD>
    <TD width="7" bgcolor="#ffffff" valign="top" align="left"></TD>
    <TD width="40" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="1" height="1" border="0"></TD>
    <TD id="breadcrumbs" width="100%" valign="middle" align="left">
      <!-- $TOP_NAV_BAR -->
      <SPAN id="Content">
        
            
                                                                                                                                                                                    
                                    
                                                
            <A href="index.html" title="Index">Index</A> | <A href="news.html" title="News">News</A> | <A href="faq.html" title="FAQ">FAQ</A> | <A href="download.html" title="Download">Download</A> | <A href="mailing-lists.html" title="Mailing Lists">Lists</A> | <SPAN class="nobr"><A href="http://issues.apache.org/jira/browse/OPENEJB" title="Visit page outside Confluence" rel="nofollow">Issues<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </SPAN>
     <IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="1" height="2" border="0"></TD>
    <TD width="120" height="20" valign="top" align="left">&nbsp;</TD>
   </TR>
   <TR>
    <TD width="20" bgcolor="#7270c2" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="20" height="3" border="0"></TD>
    <TD width="95" bgcolor="#7270c2" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/line_sm.gif" width="105" height="3" border="0"></TD>
    <TD width="7" bgcolor="#a9a5de" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/line_sm.gif" width="7" height="3" border="0"></TD>
    <TD width="40" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/line_light.gif" width="40" height="3" border="0"></TD>
    <TD width="100%" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/line_light.gif" width="430" height="3" border="0"></TD>
    <TD width="120" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" border="0" width="1" height="1"></TD>
   </TR>
   <TR>
    <TD bgcolor="#7270c2" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="20" height="10" border="0"></TD>
    <TD id="leftColumn" valign="top" style="padding-top: 0px;">
    <SPAN id="Content">
      
            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                    
                                                
            <H3><A name="Navigation-Overview"></A>Overview</H3>
<UL class="alternate" type="square">
	<LI><A href="index.html" title="Index">Home</A></LI>
	<LI><A href="news.html" title="News">News</A></LI>
	<LI><A href="faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="download.html" title="Download">Download</A></LI>
	<LI><A href="quickstart.html" title="Quickstart">Quickstart</A></LI>
	<LI><A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
	<LI><A href="source-code.html" title="Source Code">Source Code</A></LI>
</UL>


<H3><A name="Navigation-General"></A>General</H3>
<UL class="alternate" type="square">
	<LI><A href="deploy-tool.html" title="Deploy Tool">Deployment</A></LI>
	<LI><A href="startup.html" title="Startup">Startup</A></LI>
	<LI><A href="validation-tool.html" title="Validation Tool">Validation</A></LI>
	<LI><A href="webadmin.html" title="Webadmin">Webadmin</A></LI>
</UL>


<H3><A name="Navigation-Configuration"></A>Configuration</H3>
<UL class="alternate" type="square">
	<LI><A href="configuration.html" title="Configuration">General</A></LI>
	<LI><A href="deployments.html" title="Deployments">Deployments</A></LI>
	<LI><A href="containers.html" title="Containers">Containers</A></LI>
	<LI><A href="castor-cmp.html" title="Castor CMP">Castor CMP</A></LI>
</UL>


<H3><A name="Navigation-Servers"></A>Servers</H3>
<UL class="alternate" type="square">
	<LI><A href="local-server.html" title="Local Server">Local</A></LI>
	<LI><A href="remote-server.html" title="Remote Server">Remote</A></LI>
</UL>



<H3><A name="Navigation-Integrations"></A>Integrations</H3>
<UL class="alternate" type="square">
	<LI><A href="tomcat.html" title="Tomcat">Tomcat</A></LI>
	<LI><A href="geronimo.html" title="Geronimo">Geronimo</A></LI>
	<LI><A href="webobjects.html" title="WebObjects">WebObjects</A></LI>
</UL>


<H3><A name="Navigation-Community"></A>Community</H3>
<UL class="alternate" type="square">
	<LI><A href="team.html" title="Team">Team</A></LI>
	<LI><A href="help.html" title="Help">Help</A></LI>
	<LI><A href="articles.html" title="Articles">Articles</A></LI>
	<LI><A href="annoyances.html" title="Annoyances">Annoyances</A></LI>
</UL>
                                                                                                                                                                                                                </SPAN>

            <H3 class="heading3">Feeds</H3>
            <TABLE border="0" cellspacing="4px">
            <TR>
              <TD align="right">
                <A href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false"><IMG src="http://incubator.apache.org/openejb/images/rss.gif" border="0"></A><BR>
              </TD>
              <TD align="left">
                <A href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false">Site</A>
              </TD>
            </TR>
            <TR>
              <TD align="right">
                <A href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB"><IMG src="http://incubator.apache.org/openejb/images/rss.gif" border="0"></A>
              </TD>
              <TD align="left">
                <A href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB">News</A>
              </TD>
            </TR>
            </TABLE>
        </TD>
    <TD width="7" bgcolor="#a9a5de" valign="top" align="left">&nbsp;</TD>
    <TD width="40" valign="top" align="left">&nbsp;</TD>
    <TD rowspan="4" width="100%" valign="top">
     <TABLE cols="1" rows="2" border="0" cellpadding="0" cellspacing="0" width="100%">
      <TR>
       <TD valign="top" align="left"><BR>
          <TABLE cols="3" rows="1" border="0" cellpadding="0" cellspacing="0" width="100%">
          <TR>
           <TD valign="top" width="200" align="left">
           <A href="http://openejb.org/">
           <IMG border="0" hspace="0" src="http://incubator.apache.org/openejb/images/logo_openejb.gif" vspace="0">
           </A>
           </TD>
           <TD align="right" valign="middle" style="padding:0px;margin:0px;">
	      <TABLE style="padding:0px;margin:0px;">
            <TR>
                <TD>
	            <A href="http://incubator.apache.org/">
	              <IMG src="http://incubator.apache.org/images/apache-incubator-logo.png" border="0">
	            </A>
                </TD>
            <TR>
<!--
	        <tr>
	            <td align="right" valign="top" style="font- size:12px;color:#777777">
	            [OpenEJB is a Podling in the Apache Incubator]
	            </td>
	        </tr>
-->
          </TABLE>
           </TD>
          </TR>
          </TABLE>
	<BR>
      </TD>
      </TR>
      <TR>
       <TD valign="top" align="left">
         <IMG border="0" height="7" hspace="0" src="http://incubator.apache.org/openejb/images/dotTrans.gif"><BR>
          <DIV id="page_title">
            <TABLE width="100%">
              <TR>
                <TD>
	<!-- $TITLE -->
	Executables
                </TD>
                 <TD align="right" style="padding-left:0px;"><A style="color:#999;font-size:small;font-weight:normal;" href="http://cwiki.apache.org/confluence/pages/editpage.action?spaceKey=OPENEJB&title=Executables">[ edit ]</A></TD>
                <TD align="right" width="25">

            <SCRIPT type="text/javascript" language="javascript">
                document.write('<a href="http://cwiki.apache.org/confluence/pages/viewpage');
                document.write('.action?pageId=26492&decorator=printable">');
            </SCRIPT>
            <IMG src="http://cwiki.apache.org/confluence/images/icons/print_16.gif" height="16" width="16" border="0" align="absmiddle" title="Print"></A>

                </TD>
              </TR>
            </TABLE>
          </DIV>
        <IMG border="0" height="1" hspace="0" src="http://incubator.apache.org/openejb/images/dotTrans.gif"></TD>
      </TR>
     </TABLE>
     <P>
     <!-- $BODY -->
            <DIV id="PageContent">
        
        <DIV class="pagecontent">
            <DIV class="wiki-content">
                
<P>This doc describes the design-in-progress for revamping the command-line execution of openejb.</P>

<P>Basic ideas:</P>
<UL>
	<LI>Commands can be added/removed (start, stop, test, validate, deploy)</LI>
	<LI>Adding/removing only requires adding/removing jars from the classpath</LI>
</UL>


<P>We can stuff properties files into jars at:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">META-INF/org.openejb.cli/{name}</PRE>
</DIV></DIV>

<P>The propeties file will contain a main.class property, maybe an optional main.method property, and a set of description properties.</P>

<P>Here is an example of the start command:</P>

<P>It would be located at</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">META-INF/org.openejb.cli/start</PRE>
</DIV></DIV>

<DIV class="code"><DIV class="codeHeader"><B>start</B></DIV><DIV class="codeContent">
<PRE class="code-java">main.class=org.openejb.server.Main
description.en=Starts the Remote Server
description.es=Ejecuta el Servidor Remoto</PRE>
</DIV></DIV>

<P>We would pull in all these files in the launcher&apos;s main method and parse them.  If someone typed &quot;openejb --help&quot; then we would list the commands and descriptions.</P>


<H1><A name="Executables-Gettingthepropertiesfiles"></A>Getting the properties files</H1>

<P>Hiram wrote some code like this for activeio</P>

<DIV class="code"><DIV class="codeHeader"><B>FactoryFinder.java</B></DIV><DIV class="codeContent">
<PRE class="code-java">/**
 * 
 */
<SPAN class="code-keyword">package</SPAN> org.activeio;

<SPAN class="code-keyword">import</SPAN> java.io.BufferedInputStream;
<SPAN class="code-keyword">import</SPAN> java.io.IOException;
<SPAN class="code-keyword">import</SPAN> java.io.InputStream;
<SPAN class="code-keyword">import</SPAN> java.util.Properties;

<SPAN class="code-keyword">import</SPAN> EDU.oswego.cs.dl.util.concurrent.ConcurrentHashMap;

<SPAN class="code-keyword">public</SPAN> class FactoryFinder {
    
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-keyword">final</SPAN> <SPAN class="code-object">String</SPAN> path;
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-keyword">final</SPAN> ConcurrentHashMap classMap = <SPAN class="code-keyword">new</SPAN> ConcurrentHashMap();
    
    <SPAN class="code-keyword">public</SPAN> FactoryFinder(<SPAN class="code-object">String</SPAN> path) {
        <SPAN class="code-keyword">this</SPAN>.path = path;
    }

    /**
     * Creates a <SPAN class="code-keyword">new</SPAN> instance of the given key
     * 
     * @param key
     *            is the key to add to the path to find a text file
     *            containing the factory name
     * @<SPAN class="code-keyword">return</SPAN> a newly created instance
     */
    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">Object</SPAN> newInstance(<SPAN class="code-object">String</SPAN> key) <SPAN class="code-keyword">throws</SPAN> IllegalAccessException, InstantiationException, IOException,
            ClassNotFoundException {
        <SPAN class="code-keyword">return</SPAN> newInstance(key, <SPAN class="code-keyword">null</SPAN>);
    }

    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">Object</SPAN> newInstance(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">String</SPAN> propertyPrefix) <SPAN class="code-keyword">throws</SPAN> IllegalAccessException,
            InstantiationException, IOException, ClassNotFoundException {
        <SPAN class="code-keyword">if</SPAN> (propertyPrefix == <SPAN class="code-keyword">null</SPAN>)
            propertyPrefix = &quot;&quot;;
        
        <SPAN class="code-object">Class</SPAN> clazz = (<SPAN class="code-object">Class</SPAN>) classMap.get(propertyPrefix+key);
        <SPAN class="code-keyword">if</SPAN>( clazz == <SPAN class="code-keyword">null</SPAN> ) {
            clazz = newInstance(doFindFactoryProperies(key), propertyPrefix);
        }
        <SPAN class="code-keyword">return</SPAN> clazz.newInstance();
    }

    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">Class</SPAN> newInstance(Properties properties, <SPAN class="code-object">String</SPAN> propertyPrefix) <SPAN class="code-keyword">throws</SPAN> ClassNotFoundException,
            InstantiationException, IllegalAccessException, IOException {

        <SPAN class="code-object">String</SPAN> className = properties.getProperty(propertyPrefix + <SPAN class="code-quote">&quot;class&quot;</SPAN>);
        <SPAN class="code-keyword">if</SPAN> (className == <SPAN class="code-keyword">null</SPAN>) {
            <SPAN class="code-keyword">throw</SPAN> <SPAN class="code-keyword">new</SPAN> IOException(<SPAN class="code-quote">&quot;Expected property is missing: &quot;</SPAN> + propertyPrefix + <SPAN class="code-quote">&quot;class&quot;</SPAN>);
        }
        <SPAN class="code-object">Class</SPAN> clazz;
        <SPAN class="code-keyword">try</SPAN> {
            clazz = <SPAN class="code-object">Thread</SPAN>.currentThread().getContextClassLoader().loadClass(className);
        } <SPAN class="code-keyword">catch</SPAN> (ClassNotFoundException e) {
            clazz = FactoryFinder.class.getClassLoader().loadClass(className);
        }
        
        <SPAN class="code-keyword">return</SPAN> clazz;
    }

    <SPAN class="code-keyword">private</SPAN> Properties doFindFactoryProperies(<SPAN class="code-object">String</SPAN> key) <SPAN class="code-keyword">throws</SPAN> IOException, ClassNotFoundException {
        <SPAN class="code-object">String</SPAN> uri = path + key;

        <SPAN class="code-comment">// lets <SPAN class="code-keyword">try</SPAN> the thread context class loader first
</SPAN>        InputStream in = <SPAN class="code-object">Thread</SPAN>.currentThread().getContextClassLoader().getResourceAsStream(uri);
        <SPAN class="code-keyword">if</SPAN> (in == <SPAN class="code-keyword">null</SPAN>) {
            in = FactoryFinder.class.getClassLoader().getResourceAsStream(uri);
            <SPAN class="code-keyword">if</SPAN> (in == <SPAN class="code-keyword">null</SPAN>) {
                <SPAN class="code-keyword">throw</SPAN> <SPAN class="code-keyword">new</SPAN> IOException(<SPAN class="code-quote">&quot;Could not find factory class <SPAN class="code-keyword">for</SPAN> resource: &quot;</SPAN> + uri);
            }
        }

        <SPAN class="code-comment">// lets load the file
</SPAN>        BufferedInputStream reader = <SPAN class="code-keyword">null</SPAN>;
        <SPAN class="code-keyword">try</SPAN> {
            reader = <SPAN class="code-keyword">new</SPAN> BufferedInputStream(in);
            Properties properties = <SPAN class="code-keyword">new</SPAN> Properties();
            properties.load(reader);
            <SPAN class="code-keyword">return</SPAN> properties;
        } <SPAN class="code-keyword">finally</SPAN> {
            <SPAN class="code-keyword">try</SPAN> {
                reader.close();
            } <SPAN class="code-keyword">catch</SPAN> (Exception e) {
            }
        }
    }
}</PRE>
</DIV></DIV>

<P>If we used a class similar to that, we could get the commands like such:</P>

<DIV class="code"><DIV class="codeHeader"><B>Main.java</B></DIV><DIV class="codeContent">
<PRE class="code-java">FactoryFinder finder = <SPAN class="code-keyword">new</SPAN> FactoryFinder(<SPAN class="code-quote">&quot;META-INF/org.openejb.cli/&quot;</SPAN>);
Properties props = finder.doFindFactoryProperies(<SPAN class="code-quote">&quot;start&quot;</SPAN>)
commands.put(<SPAN class="code-quote">&quot;start&quot;</SPAN>,props);
<SPAN class="code-comment">// we should <SPAN class="code-keyword">try</SPAN> and load them all into properties instances and map them in advance
</SPAN>
<SPAN class="code-comment">//.. later to list help
</SPAN><SPAN class="code-object">String</SPAN> local = <SPAN class="code-comment">//get the i18n 2 character local (en, es, fr...)
</SPAN>
<SPAN class="code-keyword">for</SPAN> each commands.entrySet() ... {
   Map.Entry entry = commandEntries.next();
   <SPAN class="code-object">String</SPAN> command = entry.getKey();
   Properties props = (Properties) entry.getValue();
   <SPAN class="code-object">String</SPAN> description = props.getProperty(<SPAN class="code-quote">&quot;description.&quot;</SPAN>+local, props.getProperty(<SPAN class="code-quote">&quot;description&quot;</SPAN>));
   <SPAN class="code-object">System</SPAN>.out.print(<SPAN class="code-quote">&quot;    &quot;</SPAN>+command+<SPAN class="code-quote">&quot;\t&quot;</SPAN>+description);
}

<SPAN class="code-comment">//.. later to execute a command
</SPAN>Properties props = (Properties)commands.get(<SPAN class="code-quote">&quot;start&quot;</SPAN>);
<SPAN class="code-object">String</SPAN> mainClass = props.getProperty(<SPAN class="code-quote">&quot;main.class&quot;</SPAN>);

<SPAN class="code-object">Class</SPAN> clazz = getClassLoader().loadClass(mainClass);
Method mainMethod = clazz.getMethod(<SPAN class="code-quote">&quot;main&quot;</SPAN>, <SPAN class="code-keyword">new</SPAN> <SPAN class="code-object">Class</SPAN>[]{<SPAN class="code-object">String</SPAN>[].class});
mainMethod.invoke(args); <SPAN class="code-comment">// obviously the <SPAN class="code-quote">&quot;start&quot;</SPAN> arg has been shaved off first</SPAN></PRE>
</DIV></DIV>

<H1><A name="Executables-Actualimplementation"></A>Actual implementation</H1>
<P>I took a different approach.  Since we won&apos;t use this class to actually return a class loaded from the properties file, I made minor changes.  I also made the CommandFinder.java capable of finding all possible command homes so that others wouldn&apos;t have to implement it themselves.  Also, the CommandFinder will automatically set the openejb.home.  The idea is that we may be able to get rid of all of the scripts checking for OPENEJB_HOME for us.  This is the initial concept so please make changes or suggestions.</P>

<DIV class="code"><DIV class="codeHeader"><B>CommandFinder.java</B></DIV><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-keyword">package</SPAN> org.openejb.cli;

<SPAN class="code-keyword">import</SPAN> java.io.BufferedInputStream;
<SPAN class="code-keyword">import</SPAN> java.io.File;
<SPAN class="code-keyword">import</SPAN> java.io.IOException;
<SPAN class="code-keyword">import</SPAN> java.io.InputStream;
<SPAN class="code-keyword">import</SPAN> java.net.URL;
<SPAN class="code-keyword">import</SPAN> java.util.Collections;
<SPAN class="code-keyword">import</SPAN> java.util.Enumeration;
<SPAN class="code-keyword">import</SPAN> java.util.HashMap;
<SPAN class="code-keyword">import</SPAN> java.util.Map;
<SPAN class="code-keyword">import</SPAN> java.util.Properties;

<SPAN class="code-keyword">public</SPAN> class CommandFinder {
	<SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> path;
	<SPAN class="code-keyword">private</SPAN> Map classMap = Collections.synchronizedMap(<SPAN class="code-keyword">new</SPAN> HashMap());
	
	<SPAN class="code-keyword">public</SPAN> CommandFinder(<SPAN class="code-object">String</SPAN> path) {
		<SPAN class="code-keyword">this</SPAN>.path = path;
	}
	
    <SPAN class="code-keyword">public</SPAN> Properties doFindCommandProperies(<SPAN class="code-object">String</SPAN> key) <SPAN class="code-keyword">throws</SPAN> IOException {
        <SPAN class="code-object">String</SPAN> uri = path + key;
        
        <SPAN class="code-comment">// lets <SPAN class="code-keyword">try</SPAN> the thread context class loader first
</SPAN>        InputStream in = <SPAN class="code-object">Thread</SPAN>.currentThread().getContextClassLoader().getResourceAsStream(uri);
        <SPAN class="code-keyword">if</SPAN> (in == <SPAN class="code-keyword">null</SPAN>) {
            in = CommandFinder.class.getClassLoader().getResourceAsStream(uri);
            <SPAN class="code-keyword">if</SPAN> (in == <SPAN class="code-keyword">null</SPAN>) {
                <SPAN class="code-keyword">throw</SPAN> <SPAN class="code-keyword">new</SPAN> IOException(<SPAN class="code-quote">&quot;Could not find factory class <SPAN class="code-keyword">for</SPAN> resource: &quot;</SPAN> + uri);
            }
        }

        <SPAN class="code-comment">// lets load the file
</SPAN>        BufferedInputStream reader = <SPAN class="code-keyword">null</SPAN>;
        <SPAN class="code-keyword">try</SPAN> {
            reader = <SPAN class="code-keyword">new</SPAN> BufferedInputStream(in);
            Properties properties = <SPAN class="code-keyword">new</SPAN> Properties();
            properties.load(reader);
            
            <SPAN class="code-comment">//All is well, set openejb.home
</SPAN>            URL propsURL = <SPAN class="code-object">Thread</SPAN>.currentThread().getContextClassLoader().getResource(uri);
            <SPAN class="code-object">String</SPAN> propsString = propsURL.getFile();
            URL jarURL;
            File jarFile;
            
            propsString = propsString.substring(0, propsString.indexOf(<SPAN class="code-quote">&quot;!&quot;</SPAN>));
            
            jarURL = <SPAN class="code-keyword">new</SPAN> URL(propsString);
            jarFile = <SPAN class="code-keyword">new</SPAN> File(jarURL.getFile());
            
            <SPAN class="code-keyword">if</SPAN> (jarFile.getName().indexOf(<SPAN class="code-quote">&quot;openejb-core&quot;</SPAN>) &gt; -1) {
            	File lib = jarFile.getParentFile();
            	File home = lib.getParentFile();
            	
            	<SPAN class="code-object">System</SPAN>.setProperty(<SPAN class="code-quote">&quot;openejb.home&quot;</SPAN>, home.getAbsolutePath());
            }
            
            <SPAN class="code-keyword">return</SPAN> properties;
        } <SPAN class="code-keyword">finally</SPAN> {
            <SPAN class="code-keyword">try</SPAN> {
                reader.close();
            } <SPAN class="code-keyword">catch</SPAN> (Exception e) {
            }
        }
    }
    
    <SPAN class="code-keyword">public</SPAN> Enumeration doFindCommands() <SPAN class="code-keyword">throws</SPAN> IOException {
    	<SPAN class="code-keyword">return</SPAN> <SPAN class="code-object">Thread</SPAN>.currentThread().getContextClassLoader().getResources(path);
    }
}</PRE>
</DIV></DIV>

<H1><A name="Executables-CurrentImplementationUsage"></A>Current Implementation Usage</H1>
<P>The usage for this is the same as before but you would use the following approach to run instead of the OPENEJB_HOME/bin/openejb command:</P>
<DIV class="code"><DIV class="codeHeader"><B>Usage</B></DIV><DIV class="codeContent">
<PRE class="code-java">java -jar OPENEJB_HOME/lib/openejb-core-&lt;VERSION&gt;.jar</PRE>
</DIV></DIV>
<P>Eventually, once David and I talk, we will wrap this in a script, like we do now.  Right now, only the core commands are implemented:</P>

<UL>
	<LI>deploy</LI>
	<LI>help</LI>
	<LI>start</LI>
	<LI>stop</LI>
	<LI>validate</LI>
</UL>


<H1><A name="Executables-CurrentQuestionsBeforeIntegratingIntoMainstream"></A>Current Questions Before Integrating Into Mainstream</H1>
<UL>
	<LI>Classpath - Will the command implementors be responsible for managing their classpath?</LI>
	<LI>Logging - Will we log errors in the CommandFinder.java or continue as-is outputting StackTrace and OpenEJB messages</LI>
	<LI>Handling non-core command - We should have an OPENEJB_HOME/lib/etc where all 3rd party commands, like tests, can house their jars.  We need a standard location so the code can just work without the user having to add things to the classpath manually</LI>
	<LI>Wrapping in script - We will eventually wrap our executable jar in a script.</LI>
</UL>


<H1><A name="Executables-Help%21"></A>Help!</H1>

<P>openejb --help<BR>
(list the commands and descriptions)</P>

<P>This would be the job of the main class of the launcher.  It would find all the commands in the system, and list their names and print their &quot;description&quot; property.</P>

<P>openejb start --help <BR>
(list the start help text)</P>

<P>The main class of the launcher would do nothing with this.  The start command would need to grab it&apos;s help text and print it to the system.out.  Yes, this is extra work, but the various commands already support this.  Also, at some point we won&apos;t have the help text as is and will use commons.cli to create the text.</P>
            </DIV>
        </DIV>
    </DIV>
     </P>
    </TD>
<!--    <td width="120" height="5" valign="top" align="left"></td>   -->

   </TR>
   <TR height="5">
    <TD width="20" height="5" bgcolor="#7270c2" valign="top" align="left">&nbsp;</TD>
    <TD width="95" height="5" bgcolor="#7270c2" valign="top">&nbsp;</TD>
    <TD width="7" height="5" bgcolor="#a9a5de" valign="top" align="left">&nbsp;</TD>
    <TD width="40" height="5" valign="top" align="left">&nbsp;</TD>
    <TD width="120" height="5" valign="top" align="left">&nbsp;</TD>
   </TR>
   <TR>
    <TD width="20" height="5" bgcolor="#7270c2" valign="top" align="left">&nbsp;</TD>
    <TD width="95" bgcolor="#7270c2" valign="BOTTOM" align="left">&nbsp;</TD>
    <TD width="7" bgcolor="#a9a5de" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="1" height="25" border="0"></TD>
    <TD width="40" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="1" height="25" border="0"></TD>
    <TD width="120" valign="top" align="left">&nbsp;</TD>
   </TR>
   <TR>
    <TD width="20" height="5" bgcolor="#7270c2" valign="top" align="left">&nbsp;</TD>
    <TD width="95" bgcolor="#7270c2" valign="BOTTOM" align="left">&nbsp;</TD>
    <TD width="7" bgcolor="#a9a5de" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="1" height="25" border="0"></TD>
    <TD width="40" valign="top" align="left"><IMG src="http://incubator.apache.org/openejb/images/dotTrans.gif" width="1" height="25" border="0"></TD>
    <TD width="120" valign="top" align="left">&nbsp;</TD>
   </TR>
   <TR height="5">
    <TD width="20" rowspan="2" height="100%" bgcolor="#7270c2" valign="bottom" align="left"><IMG src="http://incubator.apache.org/openejb/images/stripes1.gif" width="20" height="125" border="0"></TD>
    <TD width="95" rowspan="2" height="100%" bgcolor="#7270c2" valign="bottom" align="left"><IMG src="http://incubator.apache.org/openejb/images/stripe105.gif" width="105" height="125" border="0"></TD>
    <TD width="7" rowspan="2" height="100%" bgcolor="#a9a5de" valign="top" align="left">&nbsp;</TD>
    <TD width="40" height="100%" valign="top" align="left">&nbsp;</TD>
    <TD width="120" height="100%" valign="top" align="left">&nbsp;</TD>
   </TR>
   <TR height="5">
    <TD width="40" height="25" valign="top" align="left">&nbsp;</TD>
    <TD width="100%" height="25" valign="bottom" align="left"><BR>
     <BR>
     <IMG src="http://incubator.apache.org/openejb/images/line_light.gif" border="0" width="430" height="3"><BR>
     <P>
     </P>
     <SPAN class="bodyGrey">
     <SMALL><NOTICE><!-- $FOOTER -->
Apache OpenEJB is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Geronimo PMC. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
     </NOTICE> <BR>
     &nbsp;<BR>
          Powered by <A href="http://atlassian.com/">Atlassian</A> <A href="http://atlassian.com/confluence/">Confluence</A>.
     </SMALL>
     </SPAN>
     <P>
     </P>
     </TD>
    <TD width="120" height="25" valign="top" align="left">&nbsp;</TD>
   </TR>
  </TABLE>
  </BODY>
 </HTML>
