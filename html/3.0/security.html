
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <!-- $PAGETITLE -->
    <TITLE>OpenEJB - Security</TITLE>
    <LINK href="http://openejb.apache.org/all.css" rel="stylesheet" type="text/css">
    <!--[if IE]><link rel="stylesheet" type="text/css" media="screen, projection" href="openejb.apache.org/ie.css"><![endif]-->

    <LINK rel="SHORTCUT ICON" href="http://openejb.apache.org/images/favicon.ico">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>

    <!-- Delay the loading of the external javascript file needed for labels (as it takes too long to load and visibly holds loading of the page body) -->
    <!-- To do this without javascript errors over undefined functions, we need to declare stubs here (that are overrided later by the proper implementations) -->
    <SCRIPT language="JavaScript" type="text/javascript">
      function doAddLabel(hideTextfieldAfterAddParam)
      {
      // stub
      }

      function onAddLabel()
      {
      // stub
      }

      function showLabelsInput()
      {
      // stub
      }
    </SCRIPT>

    <A name="top"></A>
    <TABLE class="frameTable" cellpadding="0" cellspacing="0" border="0">
      <TR class="Row1">
        <TD class="Col1"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col2"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col3"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
      </TR>
      <TR class="Row2">
        <TD class="Col1"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3" id="breadcrumbs">
          <!-- $TOP_NAV_BAR -->
                    <A href="../OPENEJB/index.html" title="Index">Home</A> | <A href="../OPENEJB/download.html" title="Download">Download</A> | <A href="../OPENEJB/mailing-lists.html" title="Mailing Lists">Lists</A> | <A href="http://issues.apache.org/jira/browse/OPENEJB" class="external-link" rel="nofollow">Issues</A>

        </TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">&nbsp;</TD>
      </TR>
      <TR class="Row3">
        <TD class="Col1"><IMG alt="" class="Row3Img" id="thinLine" src="http://openejb.apache.org/images/line_sm.gif"></TD>
        <TD class="Col2"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col3"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
      </TR>
      <TR class="Row4">
        <TD class="Col1">
          <SPAN id="Navigation">

                        <H3><A name="Navigation-Overview"></A>Overview</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/index.html" title="Index">Home</A></LI>
	<LI><A href="../OPENEJB/news.html" title="News">News</A></LI>
	<LI><A href="../OPENEJB/faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="../OPENEJB/download.html" title="Download">Download</A></LI>
	<LI><A href="index.html" title="Index">Documentation</A></LI>
	<LI><A href="../OPENEJB/examples.html" title="Examples">Examples</A></LI>
	<LI><A href="http://cwiki.apache.org/confluence/display/OPENEJB/Lightening%20Demos" class="external-link" rel="nofollow">Lightning Demos</A></LI>
	<LI><A href="../OPENEJB/mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
	<LI><A href="../OPENEJB/source-code.html" title="Source Code">Source Code</A></LI>
	<LI><A href="http://blogs.apache.org/openejb" class="external-link" rel="nofollow">Project Blog</A></LI>
</UL>


<H3><A name="Navigation-Servers"></A>Servers</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/local-server.html" title="Local Server">Local</A></LI>
	<LI><A href="../OPENEJB/remote-server.html" title="Remote Server">Remote</A></LI>
</UL>


<H3><A name="Navigation-Integrations"></A>Integrations</H3>

<UL class="alternate" type="square">
	<LI><A href="tomcat.html" title="Tomcat">Tomcat</A></LI>
	<LI><A href="../OPENEJB/geronimo.html" title="Geronimo">Geronimo</A></LI>
	<LI><A href="../OPENEJB/webobjects.html" title="WebObjects">WebObjects</A></LI>
</UL>


<H3><A name="Navigation-Community"></A>Community</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/team.html" title="Team">Team</A></LI>
	<LI><A href="../OPENEJB/articles.html" title="Articles">Articles</A></LI>
	<LI><A href="http://webchat.freenode.net/?channels=openejb" class="external-link" rel="nofollow">IRC</A></LI>
</UL>


<H3><A name="Navigation-RelatedProjects"></A>Related Projects</H3>

<UL class="alternate" type="square">
	<LI><A href="http://activemq.apache.org/" class="external-link" rel="nofollow">ActiveMQ</A></LI>
	<LI><A href="http://openjpa.apache.org/" class="external-link" rel="nofollow">OpenJPA</A></LI>
	<LI><A href="http://cxf.apache.org/" class="external-link" rel="nofollow">CXF</A></LI>
</UL>


<H3><A name="Navigation-Index"></A>Index</H3>
<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/space-index.html" title="Space Index">Site Index</A></LI>
	<LI><A href="space-index.html" title="Space Index">Doc Index</A></LI>
</UL>

            <H3>
              <A name="Navigation-Feeds"></A>
              Feeds
            </H3>

            <UL class="feeds">
            <LI>
              <A href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false">
              <IMG src="http://openejb.apache.org/images/rss.gif"></A>
              <A class="feedsText" href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false">Site</A>
            </LI>

            <LI><A href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB">
              <IMG src="http://openejb.apache.org/images/rss.gif"></A>
              <A class="feedsText" href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB">News</A>
            </LI>
            </UL>
          </SPAN>
        </TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3">
          <TABLE id="PageHeader" border="0" width="100%">
            <TR>
              <TD>
                <A href="http://openejb.org/">
                  <IMG hspace="0" src="http://openejb.apache.org/images/logo_openejb.gif" vspace="0">
                </A>
              </TD>
              <TD align="right">
                <A href="http://www.apache.org/">
                  <IMG src="http://www.apache.org/images/asf-logo.gif" width="258" height="66">
                </A>
              </TD>
            </TR>
            <TR>
              <TD id="page_title">
                <!-- $TITLE -->
                Security
              </TD>

              <TD align="right">
                <BR><BR>
                <!-- Google CSE Search Box Begins  -->
                <FORM id="searchbox_010475492895890475512:_t4iqjrgx90" action="http://www.google.com/cse">
                  <INPUT type="hidden" name="cx" value="010475492895890475512:_t4iqjrgx90">
                  <INPUT type="hidden" name="cof" value="FORID:0">
                  <INPUT name="q" type="text" size="25">
                  <INPUT type="submit" name="sa" value="Search">
                </FORM>
                <SCRIPT type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_010475492895890475512:_t4iqjrgx90"></SCRIPT>
                <!-- Google CSE Search Box Ends -->

              </TD>
            </TR>
          </TABLE>
          <P>
            <!-- $BODY -->
            <DIV id="PageContent">
              <H1><A name="Security-SecurityHowTo."></A>Security - How To.</H1>

<P>We currently have two authentication mechanisms to choose from:</P>
<UL>
	<LI><TT>PropertiesLoginModule</TT> (a basic text file based login that looks up users and groups from the specified properties files)</LI>
	<LI><TT>SQLLoginModule</TT> (database based login that looks up users and groups in a database through SQL queries)</LI>
</UL>


<P>To make your program authenticate itself to the server, simply construct your InitialContext with the standard javax.naming.Context properties for user/pass info, which is:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
Properties props = <SPAN class="code-keyword">new</SPAN> Properties();
props.setProperty(Context.INITIAL_CONTEXT_FACTORY, <SPAN class="code-quote">&quot;org.apache.openejb.client.RemoteInitialContextFactory&quot;</SPAN>);
props.setProperty(Context.PROVIDER_URL, <SPAN class="code-quote">&quot;ejbd:<SPAN class="code-comment">//localhost:4201&quot;</SPAN>);
</SPAN>props.setProperty(Context.SECURITY_PRINCIPAL, <SPAN class="code-quote">&quot;someuser&quot;</SPAN>);
props.setProperty(Context.SECURITY_CREDENTIALS, <SPAN class="code-quote">&quot;thepass&quot;</SPAN>);
props.setProperty(<SPAN class="code-quote">&quot;openejb.authentication.realmName&quot;</SPAN>, <SPAN class="code-quote">&quot;PropertiesLogin&quot;</SPAN>); <SPAN class="code-comment">// optional
</SPAN>InitialContext ctx = <SPAN class="code-keyword">new</SPAN> InitialContext(props);
ctx.lookup(...);
</PRE>
</DIV></DIV>
<P>That will get you logged in and all your calls from that context should execute as you.</P>

<P><TT>${openejb.base}/conf/login.config</TT> is a standard JAAS config file. Here, you can configure any number of security realms to authenticate against.<BR>
To specify which of the realms you want to authenticate against, you can set the <TT>openejb.authentication.realmName</TT> property to any of the configured realm names in <TT>login.config</TT>.<BR>
If you don't speficy a realm name, the default (currently <TT>PropertiesLogin</TT>) is used.<BR>
For examples and more information on JAAS configuration, see the <A href="http://java.sun.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html" class="external-link" rel="nofollow">JAAS Reference Guide</A>.</P>

<H2><A name="Security-PropertiesLoginModule"></A>PropertiesLoginModule</H2>

<P>Supported options:</P>
<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh">Option</TH>
<TH class="confluenceTh">Description</TH>
<TH class="confluenceTh">Required</TH>
</TR>
<TR>
<TD class="confluenceTd">UsersFile</TD>
<TD class="confluenceTd">name of the properties file that contains the users and their passwords</TD>
<TD class="confluenceTd"><B>yes</B></TD>
</TR>
<TR>
<TD class="confluenceTd">GroupsFile</TD>
<TD class="confluenceTd">name of the properties file that contains the groups and their member lists</TD>
<TD class="confluenceTd"><B>yes</B></TD>
</TR>
</TBODY></TABLE>
</DIV>


<P><TT>UsersFile</TT> and <TT>GroupsFile</TT> are read in on every login, so <INS>you can update them</INS> on a running system and those users will &quot;show up&quot; immediately <INS>without the need for a restart</INS> of any kind.</P>

<H2><A name="Security-SQLLoginModule"></A>SQLLoginModule</H2>

<P>You can either use a data source or configure the JDBC URL through which the user/group lookups will be made.</P>

<P>If you use a <TT>DataSource</TT>, you must specify its JNDI name with the <TT>dataSourceName</TT> option.</P>

<P>If you use JDBC directly, you have to specify at least the JDBC URL of the database.<BR>
The driver should be autodetected (provided the appropriate jar is on your classpath), but if that fails for some reason, you can force a specific driver using the <TT>jdbcDriver</TT> option.<BR>
For more information on JDBC URLs, see the <A href="http://java.sun.com/javase/6/docs/technotes/guides/jdbc/" class="external-link" rel="nofollow">JDBC Guide</A></P>

<P>The <TT>userSelect</TT> query must return a two-column list of user names (column 1) and passwords (column 2). This query should normally return a single row, which can be achieved by the use of a query parameter placeholder &quot;?&quot;.<BR>
Any such placeholders in both queries will be filled in with the username that the client is trying to log in with.<BR>
The <TT>groupSelect</TT> query must return a two-column list of user names and their groups (or &quot;roles&quot; in the EJB world).</P>

<P>Supported options:</P>
<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh">Option</TH>
<TH class="confluenceTh">Description</TH>
<TH class="confluenceTh">Required</TH>
</TR>
<TR>
<TD class="confluenceTd">dataSourceName</TD>
<TD class="confluenceTd">the name of a data source</TD>
<TD class="confluenceTd"><B>yes</B> (alternative 1)</TD>
</TR>
<TR>
<TD class="confluenceTd">jdbcURL</TD>
<TD class="confluenceTd">a standard JDBC URL</TD>
<TD class="confluenceTd"><B>yes</B> (alternative 2)</TD>
</TR>
<TR>
<TD class="confluenceTd">jdbcDriver</TD>
<TD class="confluenceTd">the fully qualified class name of the database driver</TD>
<TD class="confluenceTd">no</TD>
</TR>
<TR>
<TD class="confluenceTd">jdbcUser</TD>
<TD class="confluenceTd">the user name for accessing the database</TD>
<TD class="confluenceTd">no</TD>
</TR>
<TR>
<TD class="confluenceTd">jdbcPassword</TD>
<TD class="confluenceTd">the password for accessing the database</TD>
<TD class="confluenceTd">no</TD>
</TR>
<TR>
<TD class="confluenceTd">userSelect</TD>
<TD class="confluenceTd">the SQL query that returns a list of users and their passwords</TD>
<TD class="confluenceTd"><B>yes</B></TD>
</TR>
<TR>
<TD class="confluenceTd">groupSelect</TD>
<TD class="confluenceTd">the SQL query that returns a list of users and groups (roles)</TD>
<TD class="confluenceTd"><B>yes</B></TD>
</TR>
<TR>
<TD class="confluenceTd">digest</TD>
<TD class="confluenceTd">the name of the digest algorithm (e.g. &quot;MD5&quot; or &quot;SHA&quot;) for digest authentication</TD>
<TD class="confluenceTd">no</TD>
</TR>
<TR>
<TD class="confluenceTd">encoding</TD>
<TD class="confluenceTd">the digest encoding, can be &quot;hex&quot; or &quot;base64&quot;</TD>
<TD class="confluenceTd">no</TD>
</TR>
</TBODY></TABLE>
</DIV>


<H1><A name="Security-PLUGPOINTS"></A>PLUG POINTS</H1>

<P>There are four-five different plug points where you could customize the functionality.  From largest to smallest:</P>
<UL class="alternate" type="square">
	<LI><B>The SecurityService interface</B>:  As before all security work (authentication and authorization) is behind this interface, only the methods on it have been updated.  If you want to do something really &quot;out there&quot; or need total control, this is where you go. Plugging in your own SecurityService should really be a last resort. We still have our &quot;do nothing&quot; SecurityService implementation just as before, but it is no longer the default. <INS>You can add a new SecurityService impl by creating a service-jar.xml and packing it in your jar</INS>.  You can configure OpenEJB to use a different SecurityService via the openejb.xml.</LI>
</UL>


<UL class="alternate" type="square">
	<LI><B>JaccProvider super class</B>:  If you want to plug in your own JACC implementation to perform custom authorization (maybe do some fancy auditing), this is one way to do it without really having to understand JACC too much.  We will plug your provider in to all the places required by JACC if you simply <INS>set the system property</INS> &quot;<B>org.apache.openejb.core.security.JaccProvider</B>&quot; with the name of your JaccProvider impl.</LI>
</UL>


<UL class="alternate" type="square">
	<LI><B>Regular JACC</B>.  The JaccProvider is simply a wrapper around the many things you have to do to create and plugin a JACC provider, but you can still plugin a JACC provider in the standard ways.  Read the JACC spec for that info.</LI>
</UL>


<UL class="alternate" type="square">
	<LI><B>JAAS LoginModule</B>.  You can setup a different JAAS LoginModule to do all your authentication by simply editing the conf/login.config file which is a plain JAAS config file.  At the moment we only support username/password based login modules.  At some point it would be nice to support any kind of input for a JAAS LoginModule, but username/password at least covers the majority.  It actually <B>is</B> possible to support any LoginModule, but you would have to supply your clients with your own way to authenticate to it and write a strategy for telling the OpenEJB client what data to send to the server with each invocation request. See the <A href="http://java.sun.com/javase/6/docs/technotes/guides/security/jaas/JAASLMDevGuide.html" class="external-link" rel="nofollow">JAAS LoginModule Developer's Guide</A> for more information.</LI>
</UL>


<UL class="alternate" type="square">
	<LI><B>Client IdentityResolver</B>.  This is the just mentioned interface you would have to implement to supply the OpenEJB client with alternate data to send to the server with each invocation request. If you're plugging in a new version of this it is likely that you may also want to plugin in your own SecurityService implementation. Reason being, the object returned from IdentiyResolve.getIdentity() is sent across the wire and straight in to the<BR>
SecurityService.associate(Object) method.</LI>
</UL>

            </DIV>
          </P>
        </TD>
        <TD class="Col4"><IMG src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">
          
            
            </TD>
      </TR>
      <TR class="Row5">
        <TD class="Col1">&nbsp;</TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3">
          <BR>
          <BR>
          <IMG width="100%" height="1" src="http://openejb.apache.org/images/line_light.gif">
          <TABLE width="100%">
            <TR>
              <TD>
                <SPAN class="bodyGrey">
                  <SMALL>
                    <NOTICE><!-- $FOOTER -->
                      Apache OpenEJB is an project of The Apache Software Foundation (ASF)
                    </NOTICE>
                    <BR>
                    Site Powered by
                    <A href="http://atlassian.com/">Atlassian</A>
                    <A href="http://atlassian.com/confluence/">Confluence</A>
                    .
                  </SMALL>
                </SPAN>
              </TD>
              <TD align="right">
                <A style="color:#999;font-size:small;font-weight:normal;" href="https://cwiki.apache.org/confluence/pages/editpage.action?spaceKey=OPENEJBx30&title=Security">[ edit ]</A>
              </TD>
            </TR>
          </TABLE>
          <BR>
        </TD>
        <TD class="Col4"><IMG src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">&nbsp;</TD>
      </TR>
    </TABLE>

    <!-- Needed for composition plugin -->
    <!-- delay the loading of large javascript files to the end so that they don't interfere with the loading of page content -->
    <SPAN style="display: none">
      <SCRIPT type="text/javascript" language="JavaScript" src="http://cwiki.apache.org/confluence/labels-javascript"></SCRIPT>

      <SCRIPT src="http://www.google-analytics.com/urchin.js" type="text/javascript">
      </SCRIPT>
      <SCRIPT type="text/javascript">
        _uacct = "UA-2717626-1";
        urchinTracker();
      </SCRIPT>
    </SPAN>

  </BODY>
</HTML>