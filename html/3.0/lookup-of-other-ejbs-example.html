
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <!-- $PAGETITLE -->
    <TITLE>OpenEJB - Lookup of other EJBs Example</TITLE>
    <LINK href="http://openejb.apache.org/all.css" rel="stylesheet" type="text/css">
    <!--[if IE]><link rel="stylesheet" type="text/css" media="screen, projection" href="openejb.apache.org/ie.css"><![endif]-->

    <LINK rel="SHORTCUT ICON" href="http://openejb.apache.org/images/favicon.ico">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>

    <!-- Delay the loading of the external javascript file needed for labels (as it takes too long to load and visibly holds loading of the page body) -->
    <!-- To do this without javascript errors over undefined functions, we need to declare stubs here (that are overrided later by the proper implementations) -->
    <SCRIPT language="JavaScript" type="text/javascript">
      function doAddLabel(hideTextfieldAfterAddParam)
      {
      // stub
      }

      function onAddLabel()
      {
      // stub
      }

      function showLabelsInput()
      {
      // stub
      }
    </SCRIPT>

    <A name="top"></A>
    <TABLE class="frameTable" cellpadding="0" cellspacing="0" border="0">
      <TR class="Row1">
        <TD class="Col1"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col2"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col3"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
      </TR>
      <TR class="Row2">
        <TD class="Col1"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3" id="breadcrumbs">
          <!-- $TOP_NAV_BAR -->
                    <A href="../OPENEJB/index.html" title="Index">Home</A> | <A href="../OPENEJB/download.html" title="Download">Download</A> | <A href="../OPENEJB/mailing-lists.html" title="Mailing Lists">Lists</A> | <A href="http://issues.apache.org/jira/browse/OPENEJB" class="external-link" rel="nofollow">Issues</A>

        </TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">&nbsp;</TD>
      </TR>
      <TR class="Row3">
        <TD class="Col1"><IMG alt="" class="Row3Img" id="thinLine" src="http://openejb.apache.org/images/line_sm.gif"></TD>
        <TD class="Col2"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col3"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
      </TR>
      <TR class="Row4">
        <TD class="Col1">
          <SPAN id="Navigation">

                        <H3><A name="Navigation-Overview"></A>Overview</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/index.html" title="Index">Home</A></LI>
	<LI><A href="../OPENEJB/news.html" title="News">News</A></LI>
	<LI><A href="../OPENEJB/faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="../OPENEJB/download.html" title="Download">Download</A></LI>
	<LI><A href="index.html" title="Index">Documentation</A></LI>
	<LI><A href="../OPENEJB/examples.html" title="Examples">Examples</A></LI>
	<LI><A href="http://cwiki.apache.org/confluence/display/OPENEJB/Lightening%20Demos" class="external-link" rel="nofollow">Lightning Demos</A></LI>
	<LI><A href="../OPENEJB/mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
	<LI><A href="../OPENEJB/source-code.html" title="Source Code">Source Code</A></LI>
	<LI><A href="http://blogs.apache.org/openejb" class="external-link" rel="nofollow">Project Blog</A></LI>
</UL>


<H3><A name="Navigation-Servers"></A>Servers</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/local-server.html" title="Local Server">Local</A></LI>
	<LI><A href="../OPENEJB/remote-server.html" title="Remote Server">Remote</A></LI>
</UL>


<H3><A name="Navigation-Integrations"></A>Integrations</H3>

<UL class="alternate" type="square">
	<LI><A href="tomcat.html" title="Tomcat">Tomcat</A></LI>
	<LI><A href="../OPENEJB/geronimo.html" title="Geronimo">Geronimo</A></LI>
	<LI><A href="../OPENEJB/webobjects.html" title="WebObjects">WebObjects</A></LI>
</UL>


<H3><A name="Navigation-Community"></A>Community</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/team.html" title="Team">Team</A></LI>
	<LI><A href="../OPENEJB/articles.html" title="Articles">Articles</A></LI>
	<LI><A href="http://webchat.freenode.net/?channels=openejb" class="external-link" rel="nofollow">IRC</A></LI>
</UL>


<H3><A name="Navigation-RelatedProjects"></A>Related Projects</H3>

<UL class="alternate" type="square">
	<LI><A href="http://activemq.apache.org/" class="external-link" rel="nofollow">ActiveMQ</A></LI>
	<LI><A href="http://openjpa.apache.org/" class="external-link" rel="nofollow">OpenJPA</A></LI>
	<LI><A href="http://cxf.apache.org/" class="external-link" rel="nofollow">CXF</A></LI>
</UL>


<H3><A name="Navigation-Index"></A>Index</H3>
<UL class="alternate" type="square">
	<LI><A href="../OPENEJB/space-index.html" title="Space Index">Site Index</A></LI>
	<LI><A href="space-index.html" title="Space Index">Doc Index</A></LI>
</UL>

            <H3>
              <A name="Navigation-Feeds"></A>
              Feeds
            </H3>

            <UL class="feeds">
            <LI>
              <A href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false">
              <IMG src="http://openejb.apache.org/images/rss.gif"></A>
              <A class="feedsText" href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false">Site</A>
            </LI>

            <LI><A href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB">
              <IMG src="http://openejb.apache.org/images/rss.gif"></A>
              <A class="feedsText" href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB">News</A>
            </LI>
            </UL>
          </SPAN>
        </TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3">
          <TABLE id="PageHeader" border="0" width="100%">
            <TR>
              <TD>
                <A href="http://openejb.org/">
                  <IMG hspace="0" src="http://openejb.apache.org/images/logo_openejb.gif" vspace="0">
                </A>
              </TD>
              <TD align="right">
                <A href="http://www.apache.org/">
                  <IMG src="http://www.apache.org/images/asf-logo.gif" width="258" height="66">
                </A>
              </TD>
            </TR>
            <TR>
              <TD id="page_title">
                <!-- $TITLE -->
                Lookup of other EJBs Example
              </TD>

              <TD align="right">
                <BR><BR>
                <!-- Google CSE Search Box Begins  -->
                <FORM id="searchbox_010475492895890475512:_t4iqjrgx90" action="http://www.google.com/cse">
                  <INPUT type="hidden" name="cx" value="010475492895890475512:_t4iqjrgx90">
                  <INPUT type="hidden" name="cof" value="FORID:0">
                  <INPUT name="q" type="text" size="25">
                  <INPUT type="submit" name="sa" value="Search">
                </FORM>
                <SCRIPT type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_010475492895890475512:_t4iqjrgx90"></SCRIPT>
                <!-- Google CSE Search Box Ends -->

              </TD>
            </TR>
          </TABLE>
          <P>
            <!-- $BODY -->
            <DIV id="PageContent">
              <H1><A name="LookupofotherEJBsExample-Overview"></A>Overview</H1>

<P>This example shows how to configure JNDI to lookup other EJBs using either the <B>@EJB</B> annotation or the <B>ejb-jar.xml</B> deployment descriptor.</P>

<P>There are a couple interesting aspects in this example intended to flush out some of the more confusing, and perhaps frustrating, aspects of referring to EJBs.</P>

<UL class="alternate" type="square">
	<LI>beans themselves do not have JNDI names (this was only recently added in Java EE 6)</LI>
</UL>


<P>This is the most frustrating and hard to accept.  Java EE 5 does not have a global namespace and therefore there is no <B>singular</B> name for your EJB.  It does not matter what you do to your EJB, there is no standard way to &quot;give&quot; the bean a name that can be used by the application globally.</P>

<UL class="alternate" type="square">
	<LI>each EJB owns its own private <TT>java:comp/env</TT> namespace (<TT>java:comp/env</TT> is not global and cannot be treated that way)</LI>
	<LI>names do not magically appear in <TT>java:comp/env</TT>, they must be explicitly added.</LI>
	<LI>to get a reference to bean <TT>B</TT> in the <TT>java:comp/env</TT> namespace of bean <TT>A</TT>, bean <TT>A</TT> must declare a reference to bean <TT>B</TT>.</LI>
</UL>


<P>You read this right.  If you have 10 EJBs and all of them want to refer to bean <TT>B</TT>, then you must declare bean <TT>B</TT> as a reference 10 times (once for each of the 10 beans).  There is no standard way in Java EE 5 to do this just once for all beans.  In Java EE 6 there is a &quot;<TT>java:global</TT>&quot; namespace, a &quot;<TT>java:app</TT>&quot; namespace, and a &quot;<TT>java:module</TT>&quot; namespace where names can be defined with the desired scope.  Java EE 5 has only <TT>java:comp</TT>.</P>

<P>There are two things which make this even more confusing:</P>

<UL class="alternate" type="square">
	<LI>Servlets have always defined <TT>java:comp/env</TT> differently.  In a webapp, the <TT>java:comp/env</TT> namespace is shared by all servlets.  This is essentially equivalent to the <TT>java:module</TT> namespace in Java EE 6.  Understand there is a conflict in definition here and that for EJBs, <TT>java:comp</TT> is scoped at the component (the EJB itself) not the module as with webapps.</LI>
	<LI>All vendors have some proprietary concept of global JNDI.  So you may be able to lookup &quot;<TT>java:/MyBean</TT>&quot; or &quot;<TT>MyBeanLocal</TT>&quot;, but these are vendor-specific and non-portable.</LI>
</UL>


<P>As well this example shows some other interesting aspects of referring to EJBs:</P>

<UL class="alternate" type="square">
	<LI>Two beans may use the same business interfaces, the interface alone does not necessarily identify the exact bean</LI>
	<LI>circular references are possible</LI>
</UL>


<P>To illustrate all of this, we have two simple @Stateless beans, <TT>RedBean</TT> and <TT>BlueBean</TT>.  Both implement the same business local interface, <TT>Friend</TT>.  Both <TT>RedBean</TT> and <TT>BlueBean</TT> define <TT>java:comp/env/myFriend</TT> differently which is allowed as <TT>java:comp</TT> is a namespace that is private to each bean and not visible to other beans &ndash; so the names do not have to match. </P>


<H1><A name="LookupofotherEJBsExample-TheCode"></A>The Code</H1>

<P>Here we show the code for <TT>RedBean</TT> and <TT>BlueBean</TT> and their shared business local interface <TT>Friend</TT>.</P>
<DIV class="error"><SPAN class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</SPAN> </DIV>
<DIV class="error"><SPAN class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</SPAN> </DIV>
<DIV class="error"><SPAN class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</SPAN> </DIV>

<P>The key items in the above are the following:</P>
<UL class="alternate" type="square">
	<LI><TT>@EJB</TT> has been used at the <B>class level</B> to declare <TT>myFriend</TT> in the <TT>java:comp/env</TT> namespace of each EJB</LI>
	<LI>because both beans share the <B>same interface</B>, <TT>Friend</TT>, we need to add <B><TT>beanName</TT></B> to the <TT>@EJB</TT> usage to specify the exact EJB we want</LI>
	<LI>for <TT>BlueBean</TT> the <TT>java:comp/env/myFriend</TT> name has been configured to point to <TT>RedBean</TT></LI>
	<LI>for <TT>RedBean</TT> the <TT>java:comp/env/myFriend</TT> name has been configured to point to <TT>BlueBean</TT></LI>
</UL>


<H2><A name="LookupofotherEJBsExample-Alternativetoannotations"></A>Alternative to annotations</H2>

<P>If there is a desire to not use annotations, the above annotation usage is equivalent to the following ejb-jar.xml</P>
<DIV class="error"><SPAN class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</SPAN> </DIV>

<H1><A name="LookupofotherEJBsExample-Writingaunittestfortheexample"></A>Writing a unit test for the example</H1>

<P>Writing an unit test for this example is quite simple. We need just to write a setup method to create and initialize the InitialContext, and then write our test methods</P>

<DIV class="error"><SPAN class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</SPAN> </DIV>

<H1><A name="LookupofotherEJBsExample-Running"></A>Running</H1>

<P>Running the example is fairly simple.  In the &quot;lookup-of-ejbs&quot; directory of the <A href="../OPENEJB/download.html" title="Download">examples zip</A>, just run:</P>

<BLOCKQUOTE>
<P>$ mvn clean install</P></BLOCKQUOTE>

<P>Which should create output like the following.</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.superbiz.ejblookup.EjbDependencyTest
Apache OpenEJB 3.1.5-SNAPSHOT    build: 20101129-09:51
http://openejb.apache.org/
INFO - openejb.home = /Users/dblevins/work/openejb-3.1.x/examples/lookup-of-ejbs
INFO - openejb.base = /Users/dblevins/work/openejb-3.1.x/examples/lookup-of-ejbs
INFO - Configuring Service(id=Default Security Service, type=SecurityService, provider-id=Default Security Service)
INFO - Configuring Service(id=Default Transaction Manager, type=TransactionManager, provider-id=Default Transaction Manager)
INFO - Found EjbModule in classpath: /Users/dblevins/work/openejb-3.1.x/examples/lookup-of-ejbs/target/classes
INFO - Beginning load: /Users/dblevins/work/openejb-3.1.x/examples/lookup-of-ejbs/target/classes
INFO - Configuring enterprise application: classpath.ear
INFO - Configuring Service(id=Default Stateless Container, type=Container, provider-id=Default Stateless Container)
INFO - Auto-creating a container for bean BlueBean: Container(type=STATELESS, id=Default Stateless Container)
INFO - Enterprise application &quot;classpath.ear&quot; loaded.
INFO - Assembling app: classpath.ear
INFO - Jndi(name=BlueBeanLocal) --&gt; Ejb(deployment-id=BlueBean)
INFO - Jndi(name=RedBeanLocal) --&gt; Ejb(deployment-id=RedBean)
INFO - Created Ejb(deployment-id=RedBean, ejb-name=RedBean, container=Default Stateless Container)
INFO - Created Ejb(deployment-id=BlueBean, ejb-name=BlueBean, container=Default Stateless Container)
INFO - Deployed Application(path=classpath.ear)
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.244 sec

Results :

Tests run: 2, Failures: 0, Errors: 0, Skipped: 0
</PRE>
</DIV></DIV>

            </DIV>
          </P>
        </TD>
        <TD class="Col4"><IMG src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">
          
            
            </TD>
      </TR>
      <TR class="Row5">
        <TD class="Col1">&nbsp;</TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3">
          <BR>
          <BR>
          <IMG width="100%" height="1" src="http://openejb.apache.org/images/line_light.gif">
          <TABLE width="100%">
            <TR>
              <TD>
                <SPAN class="bodyGrey">
                  <SMALL>
                    <NOTICE><!-- $FOOTER -->
                      Apache OpenEJB is an project of The Apache Software Foundation (ASF)
                    </NOTICE>
                    <BR>
                    Site Powered by
                    <A href="http://atlassian.com/">Atlassian</A>
                    <A href="http://atlassian.com/confluence/">Confluence</A>
                    .
                  </SMALL>
                </SPAN>
              </TD>
              <TD align="right">
                <A style="color:#999;font-size:small;font-weight:normal;" href="https://cwiki.apache.org/confluence/pages/editpage.action?spaceKey=OPENEJBx30&title=Lookup%20of%20other%20EJBs%20Example">[ edit ]</A>
              </TD>
            </TR>
          </TABLE>
          <BR>
        </TD>
        <TD class="Col4"><IMG src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">&nbsp;</TD>
      </TR>
    </TABLE>

    <!-- Needed for composition plugin -->
    <!-- delay the loading of large javascript files to the end so that they don't interfere with the loading of page content -->
    <SPAN style="display: none">
      <SCRIPT type="text/javascript" language="JavaScript" src="http://cwiki.apache.org/confluence/labels-javascript"></SCRIPT>

      <SCRIPT src="http://www.google-analytics.com/urchin.js" type="text/javascript">
      </SCRIPT>
      <SCRIPT type="text/javascript">
        _uacct = "UA-2717626-1";
        urchinTracker();
      </SCRIPT>
    </SPAN>

  </BODY>
</HTML>