
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <!-- $PAGETITLE -->
    <TITLE>OpenEJB - Webadmin</TITLE>
    <LINK href="http://openejb.apache.org/all.css" rel="stylesheet" type="text/css">
    <!--[if IE]><link rel="stylesheet" type="text/css" media="screen, projection" href="openejb.apache.org/ie.css"><![endif]-->

    <LINK rel="SHORTCUT ICON" href="http://openejb.apache.org/images/favicon.ico">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
<SCRIPT language="javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js" type="text/javascript"></SCRIPT>
<SCRIPT language="javascript" src="http://openejb.apache.org/tweet/jquery.tweet.js" type="text/javascript"></SCRIPT>
<SCRIPT type="text/javascript">
    $(document).ready(function(){
        $(".tweet").tweet({
        avatar_size: 32,
        count: 4,
	fetch:25,
        username: "openejb",
        list: "contributors",
	template:"{avatar}{text}",
	filter: function(t){ return /openejb/i.test(t["tweet_raw_text"]); },
        loading_text: "loading list..."
        });
    });
</SCRIPT> 

  </HEAD>
  <BODY>

    <!-- Delay the loading of the external javascript file needed for labels (as it takes too long to load and visibly holds loading of the page body) -->
    <!-- To do this without javascript errors over undefined functions, we need to declare stubs here (that are overrided later by the proper implementations) -->
    <SCRIPT language="JavaScript" type="text/javascript">
      function doAddLabel(hideTextfieldAfterAddParam)
      {
      // stub
      }

      function onAddLabel()
      {
      // stub
      }

      function showLabelsInput()
      {
      // stub
      }
    </SCRIPT>

    <A name="top"></A>
    <TABLE class="frameTable" cellpadding="0" cellspacing="0" border="0">
      <TR class="Row1">
        <TD class="Col1"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col2"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col3"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
      </TR>
      <TR class="Row2">
        <TD class="Col1"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3" id="breadcrumbs">
          <!-- $TOP_NAV_BAR -->
                    <A href="index.html" title="Index">Home</A> | <A href="news.html" title="News">News</A> | <A href="faq.html" title="FAQ">FAQ</A> | <A href="download.html" title="Download">Download</A> | <A href="mailing-lists.html" title="Mailing Lists">Lists</A> | <A href="http://issues.apache.org/jira/browse/OPENEJB" class="external-link" rel="nofollow">Issues</A>

        </TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">&nbsp;</TD>
      </TR>
      <TR class="Row3">
        <TD class="Col1"><IMG alt="" class="Row3Img" id="thinLine" src="http://openejb.apache.org/images/line_sm.gif"></TD>
        <TD class="Col2"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col3"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col4"><IMG alt="" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5"><IMG alt="" class="Row3Img" src="http://openejb.apache.org/images/dotTrans.gif"></TD>
      </TR>
      <TR class="Row4">
        <TD class="Col1">
          <SPAN id="Navigation">

                        <H3><A name="Navigation-Overview"></A>Overview</H3>

<UL class="alternate" type="square">
	<LI><A href="index.html" title="Index">Home</A></LI>
	<LI><A href="news.html" title="News">News</A></LI>
	<LI><A href="faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="download.html" title="Download">Download</A></LI>
	<LI><A href="../OPENEJBx30/index.html" title="Index">Documentation</A></LI>
	<LI><A href="examples.html" title="Examples">Examples</A></LI>
	<LI><A href="http://cwiki.apache.org/confluence/display/OPENEJB/Lightening%20Demos" class="external-link" rel="nofollow">Lightning Demos</A></LI>
	<LI><A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
	<LI><A href="source-code.html" title="Source Code">Source Code</A></LI>
	<LI><A href="http://blogs.apache.org/openejb" class="external-link" rel="nofollow">Project Blog</A></LI>
</UL>


<H3><A name="Navigation-Servers"></A>Servers</H3>

<UL class="alternate" type="square">
	<LI><A href="local-server.html" title="Local Server">Local</A></LI>
	<LI><A href="remote-server.html" title="Remote Server">Remote</A></LI>
</UL>


<H3><A name="Navigation-Integrations"></A>Integrations</H3>

<UL class="alternate" type="square">
	<LI><A href="../OPENEJBx30/tomcat.html" title="Tomcat">Tomcat</A></LI>
	<LI><A href="geronimo.html" title="Geronimo">Geronimo</A></LI>
	<LI><A href="webobjects.html" title="WebObjects">WebObjects</A></LI>
</UL>


<H3><A name="Navigation-Community"></A>Community</H3>

<UL class="alternate" type="square">
	<LI><A href="team.html" title="Team">Team</A></LI>
	<LI><A href="articles.html" title="Articles">Articles</A></LI>
	<LI><A href="http://webchat.freenode.net/?channels=openejb" class="external-link" rel="nofollow">IRC</A></LI>
</UL>


<H3><A name="Navigation-RelatedProjects"></A>Related Projects</H3>

<UL class="alternate" type="square">
	<LI><A href="http://activemq.apache.org/" class="external-link" rel="nofollow">ActiveMQ</A></LI>
	<LI><A href="http://openjpa.apache.org/" class="external-link" rel="nofollow">OpenJPA</A></LI>
	<LI><A href="http://cxf.apache.org/" class="external-link" rel="nofollow">CXF</A></LI>
</UL>


<H3><A name="Navigation-Index"></A>Index</H3>
<UL class="alternate" type="square">
	<LI><A href="space-index.html" title="Space Index">Site Index</A></LI>
	<LI><A href="../OPENEJBx30/space-index.html" title="Space Index">Doc Index</A></LI>
</UL>

            <H3>
              <A name="Navigation-Feeds"></A>
              Feeds
            </H3>

            <UL class="feeds">
            <LI>
              <A href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false">
              <IMG src="http://openejb.apache.org/images/rss.gif"></A>
              <A class="feedsText" href="http://cwiki.apache.org/confluence/spaces/rss.action?key=OPENEJB&newPages=false">Site</A>
            </LI>

            <LI><A href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB">
              <IMG src="http://openejb.apache.org/images/rss.gif"></A>
              <A class="feedsText" href="http://cwiki.apache.org/confluence/spaces/blogrss.action?key=OPENEJB">News</A>
            </LI>
            </UL>
          </SPAN>
        </TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3">
          <TABLE id="PageHeader" border="0" width="100%">
            <TR>
              <TD>
                <A href="http://openejb.org/">
                  <IMG hspace="0" src="http://openejb.apache.org/images/logo_openejb.gif" vspace="0">
                </A>
              </TD>
              <TD align="right">
                <A href="http://www.apache.org/">
                  <IMG src="http://www.apache.org/images/asf-logo.gif" width="258" height="66">
                </A>
              </TD>
            </TR>
            <TR>
              <TD id="page_title">
                <!-- $TITLE -->
                Webadmin
              </TD>

              <TD align="right">
                <BR><BR>
                <!-- Google CSE Search Box Begins  -->
                <FORM id="searchbox_010475492895890475512:_t4iqjrgx90" action="http://www.google.com/cse">
                  <INPUT type="hidden" name="cx" value="010475492895890475512:_t4iqjrgx90">
                  <INPUT type="hidden" name="cof" value="FORID:0">
                  <INPUT name="q" type="text" size="25">
                  <INPUT type="submit" name="sa" value="Search">
                </FORM>
                <SCRIPT type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_010475492895890475512:_t4iqjrgx90"></SCRIPT>
                <!-- Google CSE Search Box Ends -->

              </TD>
            </TR>
          </TABLE>
          <P>
            <!-- $BODY -->
            <DIV id="PageContent">
              <P>The Webadmin is a new addition to OpenEJB 1.0 and very innovative in that it lets you plug-in your own admin beans.  Here are some screenshots:</P>

<UL class="alternate" type="square">
	<LI><A href="http://openejb.apache.org/images/webadmin-main.png" class="external-link" rel="nofollow">Main</A></LI>
	<LI><A href="http://openejb.apache.org/images/webadmin-ejbdetails.png" class="external-link" rel="nofollow">EJB Details</A></LI>
	<LI><A href="http://openejb.apache.org/images/webadmin-listlogs.png" class="external-link" rel="nofollow">List Logs</A></LI>
	<LI><A href="http://openejb.apache.org/images/webadmin-properties.png" class="external-link" rel="nofollow">System Properties</A></LI>
	<LI><A href="http://openejb.apache.org/images/webadmin-viewjndi.png" class="external-link" rel="nofollow">JNDI Viewer</A></LI>
	<LI><A href="http://openejb.apache.org/images/webadmin-ejbviewer.png" class="external-link" rel="nofollow">EJB Viewer</A></LI>
	<LI><A href="http://openejb.apache.org/images/webadmin-objectinvoker.png" class="external-link" rel="nofollow">Object and EJB Invoker</A></LI>
</UL>


<H2><A name="Webadmin-EnablingtheWebadminin1.0beta1"></A>Enabling the Webadmin in 1.0 beta 1</H2>

<P>The Webadmin console is in the 1.0 beta 1 release.  To enable it, simply move into the openejb.home directory and <B>copy</B> the openejb-webadmin-main.jar from the <EM>beans</EM> directory into the <EM>lib</EM> directory.  Then start the server.</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>mingus:~/
$ cd /usr/local/openejb-1.0-beta1

mingus:/usr/local/openejb-1.0-beta1 03:37:33 
$ cp beans/openejb-webadmin-main.jar lib/

mingus:/usr/local/openejb-1.0-beta1 03:37:52 
$ ./bin/openejb start
OPENEJB_HOME = /usr/local/openejb-1.0-beta1
OpenEJB 1.0-beta1    build: 20050829-2233
http://www.openejb.org
resources 1
OpenEJB ready.
[init] OpenEJB Remote Server
  ** Starting Services **
  NAME                 IP              PORT  
  admin thread         127.0.0.1       4200  
  ejbd                 127.0.0.1       4201  
  telnet               127.0.0.1       4202  
  webadmin             127.0.0.1       4203  
-------
Ready!
</PRE>
</DIV></DIV>

<P>Now you can open your browser to go to <A href="http://localhost:4203/" class="external-link" rel="nofollow">http://localhost:4203/</A></P>

<H1><A name="Webadmin-WebAdminBeans"></A>WebAdmin Beans</H1>

<P>To create an EJB and have it included as part of the WebAdmin, simply subclass from WebAdminBean and include it in your ejb-jar.xml file as such:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>ejb-jar.xml</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml"> 
  <SPAN class="code-tag">&lt;session&gt;</SPAN>
    <SPAN class="code-tag">&lt;description&gt;</SPAN>A JNDI viewer<SPAN class="code-tag">&lt;/description&gt;</SPAN>
    <SPAN class="code-tag">&lt;ejb-name&gt;</SPAN>webadmin/ViewJndi<SPAN class="code-tag">&lt;/ejb-name&gt;</SPAN>
    <SPAN class="code-tag">&lt;home&gt;</SPAN>org.openejb.webadmin.HttpHome<SPAN class="code-tag">&lt;/home&gt;</SPAN>
    <SPAN class="code-tag">&lt;remote&gt;</SPAN>org.openejb.webadmin.HttpObject<SPAN class="code-tag">&lt;/remote&gt;</SPAN>
    <SPAN class="code-tag">&lt;ejb-class&gt;</SPAN>org.openejb.webadmin.clienttools.ViewJndiBean<SPAN class="code-tag">&lt;/ejb-class&gt;</SPAN>
    <SPAN class="code-tag">&lt;session-type&gt;</SPAN>Stateless<SPAN class="code-tag">&lt;/session-type&gt;</SPAN>
    <SPAN class="code-tag">&lt;transaction-type&gt;</SPAN>Bean<SPAN class="code-tag">&lt;/transaction-type&gt;</SPAN>
  <SPAN class="code-tag">&lt;/session&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>The ejb-name is used to create the menus and should follow the format of 'menu-section/menu-item'. WebAdminBeans are grouped together by the 'menu-section' portion of their ejb-name. The 'menu-item' is the clickable link that causes the EJB code to be execute. Very simple and makes it possible to package administrative components with your EJB applications.</P>

<H1><A name="Webadmin-WebAdminPlugins"></A>WebAdmin Plugins</H1>

<P>Here is a project that already takes advantage of the new feature. <A href="http://beangen.sourceforge.net/" class="external-link" rel="nofollow">BeanGen</A></P>

<H1><A name="Webadmin-Developersguide"></A>Developers guide</H1>
<P>Below is David Blevins' email on how webadmin worked. Please have a look at the text below before you start working on porting the existing WebAdmin to version 3.</P>

<P>Plain old stateless beans were used as the &quot;servlets&quot;.  To make a bean that would show up in the Webadmin Console you simply had to implement the HttpBean interface (i think it's now called HttpListener) and give your bean a deploymentId following this format &quot;webadmin/<TABLE class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><TBODY><TR><P>/{page}&quot;.  Anyone could add to the Webadmin console by doing both of these things, which is really cool as people developing EJB apps can also deploy beans for administering those apps right in the exact same jar.  This is not only easy for packaging but means new sections can be added/removed on the fly.</P>

<P>Using the described &quot;webadmin/</P></TR></TBODY></TABLE>/{page}&quot; deploymentId format, things end up automagically grouped in the JNDI tree.  There's a 'webadmin' context we grab which will contain any number of &quot;section&quot; contexts (&quot;ClientTools&quot;, &quot;EJBGenerator&quot;, etc.).  Each of those section subcontexts will contain several beans which we will use to make the pages.  Making the menu is pretty easy as we just iterate over the webadmin section of the global jndi tree.</P>

<P>When an http request came in we just took the path part of the GET or POST request, prepended &quot;webadmin/&quot; and then went looking for a bean with that deployment id and invoked it via it's HttpBean (now called HttpListener) interface passing in a HttpRequest and HttpResponse objects which are trimmed down versions of similar servlet classes.<BR>
There'll be some changes to this as now we support our plain ejb protocol over our http implementation, so the two will have to find a way to share the URL space.  See the openejb-http module.</P>

<P>To implement session state, we had a stateful session bean implementing an HttpSession interface (again, similar to the servlet equivalent) and simply wrote the internal ID of the bean instance into a Cookie sent to the browser.  For some reason we would write the javax.ejb.Handle of the stateful bean's EJBObject to disk and<BR>
read it back out on subsequent requests then used it to get a reference to the EJBObject again.  I'm not sure why we didn't just keep a static hashmap and put the EJBObject right in it using an ID we could just make up like UUID (that would have been way simpler).</P>

<P>We had a standard superclass we favored for beans that implemented the HttpBean (HttpListener) interface that did templating and the aforementioned menu  construction.  The templating was perhaps too tricky as we used a non-printable character to determine where to insert data.  Now we could just use swizzle-stream for some pretty decent templating ability or even velocity.  I'd be hesitant to endorse velocity as we already have a dep on swizzle-stream and wouldn't want to see us add another meg to our distro size if we can avoid it &ndash; we have like 3 times as many deps as 1.0 did and we should probably start tightening the belt.</P>

<P>To serve static things like images, we had a &quot;default&quot; HttpBean which searched for the items in the classpath and wrote them into the response setting the mime type, etc. correctly.  One thing that we never did which still needs to happen is that the bean didn't have the logic to set the modification information into the response so the &quot;If modified since&quot; header which would allow the browser to rely on it's cache instead of requesting the same images over and over again.</P>

<P>That pretty much covers the way it was put together.</P>


<UL class="alternate" type="square">
	<LI>The Jndi Viewer, Class Viewer, Ejb Viewer, and Object Invoker<BR>
were written by yours truly</LI>
	<LI>The EJB Generator was written by Jeremy Whitlock</LI>
	<LI>Everything else was written by Tim Urberg.  Tim was &quot;WebAdmin guy&quot; for a good long while.  Before Tim came along the webadmin was just some experimental code I<BR>
    had in a branch, he did more than he realizes by putting his energy into it &ndash; active people attract/ create more active people.  Maybe we can convince him to <BR>
    come back and work on it <IMG class="emoticon" src="https://cwiki.apache.org/confluence/images/icons/emoticons/wink.gif" height="20" width="20" align="absmiddle" alt="" border="0"></LI>
</UL>


<P>And of course I have to mention our own Paulo Lopes who wrote a really cool project out in SF.net (<A href="http://beangen.sourceforge.net/" class="external-link" rel="nofollow">http://beangen.sourceforge.net/</A>) which was the first plugin for the OpenEJB Webadmin.  He wrote it before we even had shipped a release containing the Webadmin or had any docs at all on it, which in my mind shows just how neat the idea of using ejb's and simple conventions to do the console really is.</P>

<P>Some notes going forward is that we have a truck load of meta-data now available via SystemInstance.get().get (OpenEjbConfiguration.class).  Certainly JSR-77 is one option, but we could do far better with plain old java code.  That tree is the primary source of meta-data for OpenEJB, it's what was used to construct every container, bean, resource adapter, database connector and <B>everything</B> in the system (well, sans the protocols).  Someone new to the project can look at it and understand it without having to read any abstract specs.  Something to consider.  The tree is read only in it's function, however it is possible to copy then edit and make new containers, etc. based on existing definitions.</P>

<P>Additionally, using this same data structure it's possible to show the potential services available via the service-jar.xml files in the classpath that detail containers, resource adapters, database connectors, etc. which can be configured/created at runtime.  So we could also display a sort of catalogue of components (aka. services) that someone could click and deploy via the console.</P>
            </DIV>
          </P>
        </TD>
        <TD class="Col4"><IMG src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">
                    
        </TD>
      </TR>
      <TR class="Row5">
        <TD class="Col1">&nbsp;</TD>
        <TD class="Col2">&nbsp;</TD>
        <TD class="Col3">
          <BR>
          <BR>
          <IMG width="100%" height="1" src="http://openejb.apache.org/images/line_light.gif">
          <TABLE width="100%">
            <TR>
              <TD>
                <SPAN class="bodyGrey">
                  <SMALL>
                    <NOTICE><!-- $FOOTER -->
                      Apache OpenEJB is an project of The Apache Software Foundation (ASF)
                    </NOTICE>
                    <BR>
                    Site Powered by
                    <A href="http://atlassian.com/">Atlassian</A>
                    <A href="http://atlassian.com/confluence/">Confluence</A>
                    .
                  </SMALL>
                </SPAN>
              </TD>
              <TD align="right">
                <A style="color:#999;font-size:small;font-weight:normal;" href="https://cwiki.apache.org/confluence/pages/editpage.action?spaceKey=OPENEJB&title=Webadmin">[ edit ]</A>
              </TD>
            </TR>
          </TABLE>
          <BR>
        </TD>
        <TD class="Col4"><IMG src="http://openejb.apache.org/images/dotTrans.gif"></TD>
        <TD class="Col5">&nbsp;</TD>
      </TR>
    </TABLE>

    <!-- Needed for composition plugin -->
    <!-- delay the loading of large javascript files to the end so that they don't interfere with the loading of page content -->
    <SPAN style="display: none">
      <SCRIPT type="text/javascript" language="JavaScript" src="http://cwiki.apache.org/confluence/labels-javascript"></SCRIPT>

      <SCRIPT src="http://www.google-analytics.com/urchin.js" type="text/javascript">
      </SCRIPT>
      <SCRIPT type="text/javascript">
        _uacct = "UA-2717626-1";
        urchinTracker();
      </SCRIPT>
    </SPAN>

  </BODY>
</HTML>